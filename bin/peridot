#!/usr/bin/env php
<?php

use Peridot\Core\SpecResult;
use Peridot\Runner\Runner;
use Peridot\Runner\SuiteLoader;

$files = array(
    __DIR__ . '/../../vendor/autoload.php',
    __DIR__ . '/../../../autoload.php',
    dirname(__DIR__) . '/vendor/autoload.php'
);

$found = false;

foreach ($files as $file) {
    if (file_exists($file)) {
        require $file;
        $found = true;
        break;
    }
}

if (!$found) {
    die(
        'You need to set up the project dependencies using the following commands:' . PHP_EOL .
        'curl -s http://getcomposer.org/installer | php' . PHP_EOL .
        'php composer.phar install' . PHP_EOL
    );
}

// todo - we are going to need to know how to find the bootstrap when installed as a library in another project
require_once 'bootstrap.php';

$loader = new SuiteLoader();
// todo - we are going to need to know where to find the specs from within another project
$specs = $loader->load(dirname(__DIR__) . '/specs/');
$result = new SpecResult();
$runner = new Runner($result);
foreach ($specs as $file) {
    $runner->runSpec($file);
}
$result = $runner->getResult();
print $result->getSummary() . "\n";

